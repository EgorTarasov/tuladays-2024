import{c as x,r,j as e,b as c,T as V,d as D,e as W,f as I,o as v,u as S,g as T,h as O,m as H,i as P,D as B,k as F,B as u,l as _,n as U,p as R,q as z,s as G,J as q,t as J,I as $,O as K}from"./index-4yMN-NVw.js";import{P as Q,T as X,a as Y,b as j,c as Z,d as ee,e as te,S as re}from"./table-C9b8UqDF.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=x("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=x("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=x("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),oe=t=>r.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},r.createElement("path",{d:"M8 13.3334V6.66669",stroke:"#EF4444",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M12 13.3334V2.66669",stroke:"#EF4444",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M4 13.3334V10.6667",stroke:"#EF4444",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),ie=t=>r.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},r.createElement("path",{d:"M8 13.3334V6.66669",stroke:"#16A34A",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M12 13.3334V2.66669",stroke:"#CBD5E1",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M4 13.3334V10.6667",stroke:"#16A34A",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),le=t=>r.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},r.createElement("path",{d:"M8 13.3334V6.66669",stroke:"#CBD5E1",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M12 13.3334V2.66669",stroke:"#CBD5E1",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M4 13.3334V10.6667",stroke:"#16A34A",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),ce=t=>r.createElement("svg",{width:40,height:40,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},r.createElement("rect",{width:40,height:40,rx:12,fill:"currentColor"}),r.createElement("rect",{x:4.28564,y:4.28571,width:31.4286,height:31.4286,rx:12,fill:"#EF4444"}),r.createElement("path",{d:"M20 30V15.7143",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M27.1431 30V10",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M12.8574 30V21.4286",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"})),de=t=>r.createElement("svg",{width:40,height:40,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},r.createElement("rect",{width:40,height:40,rx:12,fill:"currentColor"}),r.createElement("rect",{x:4.28564,y:4.28571,width:31.4286,height:31.4286,rx:12,fill:"#F77700"}),r.createElement("path",{d:"M20 30V15.7143",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M27.1431 30V10",stroke:"white",strokeOpacity:.4,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M12.8574 30V21.4286",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"})),he=t=>r.createElement("svg",{width:40,height:40,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},r.createElement("rect",{width:40,height:40,rx:12,fill:"currentColor"}),r.createElement("rect",{x:4.28571,y:4.28577,width:31.4286,height:31.4286,rx:12,fill:"#FACC15"}),r.createElement("path",{d:"M20 29.9999V15.7142",stroke:"white",strokeOpacity:.4,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M27.1429 30V10",stroke:"white",strokeOpacity:.4,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M12.8572 29.9999V21.4285",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}));var l=(t=>(t[t.HIGH=3]="HIGH",t[t.MEDIUM=2]="MEDIUM",t[t.LOW=1]="LOW",t))(l||{});const w={3:{locale:"Высокий",alternateLocale:"Высокая",color:"#EF4444",backgroundColor:"rgba(239, 68, 68, 0.2)",icon:e.jsx(oe,{}),alternateIcon:e.jsx(ce,{})},2:{locale:"Средний",alternateLocale:"Средняя",color:"# #0EA5E9",backgroundColor:"rgba(14, 165, 233, 0.2)",icon:e.jsx(ie,{}),alternateIcon:e.jsx(de,{})},1:{locale:"Низкий",alternateLocale:"Низкая",color:"#16A34A",backgroundColor:"rgba(22, 163, 74, 0.2)",icon:e.jsx(le,{}),alternateIcon:e.jsx(he,{})}},pe=t=>{const s=t.data>=.8?l.HIGH:t.data>=.5?l.MEDIUM:l.LOW,n=w[s],a=s!==l.LOW;return e.jsxs("div",{className:c("flex items-center rounded-sm w-fit py-0.5 px-2 gap-2 w-fit"),style:{backgroundColor:n.backgroundColor,color:n.color},children:[a&&e.jsx(ne,{className:"size-4"}),t.text&&e.jsx("span",{className:"text-sm",children:t.text})]})},me=t=>{const s=t.data>=.8?l.HIGH:t.data>=.5?l.MEDIUM:l.LOW,n=w[s];return e.jsxs(V,{children:[e.jsx(D,{className:c(t.alternate&&"text-card",t.className),children:t.alternate?n.alternateIcon:n.icon}),e.jsx(W,{children:e.jsxs(I,{children:[n.locale," приоритет"]})})]})},ue=v(t=>{const s=S(),{id:n}=T({strict:!1});return e.jsxs("li",{onClick:()=>s({to:"/patient/$id",params:{id:t.item.id.toString()}}),className:c("flex flex-col relative py-3 px-5 cursor-pointer",n===t.item.id.toString()&&"bg-slate-50"),children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("small",{className:"text-slate-500 font-medium block",children:t.item.first_name}),e.jsxs("p",{className:"text-lg font-medium",children:[t.item.last_name," ",t.item.first_name," ",t.item.middle_name]})]}),e.jsx(me,{data:t.item.risk_of_disease})]}),e.jsx(pe,{data:t.item.risk_of_disease,text:t.item.alert}),e.jsx("p",{className:"text-slate-800 text-sm pt-1 pb-3",children:t.item.diagnosis}),e.jsx("a",{href:t.item.telegram_link,target:"_blank",onClick:a=>a.stopPropagation(),className:c(O({variant:"outline",size:"sm"})),children:"Написать сообщение"})]})});class xe{patients=[];constructor(){H(this),this.init()}async init(){const[s]=await Promise.all([Q.get()]);this.patients=s}}const E=new xe,ge=P("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),L=r.forwardRef(({className:t,variant:s,...n},a)=>e.jsx("div",{ref:a,role:"alert",className:c(ge({variant:s}),t),...n}));L.displayName="Alert";const y=r.forwardRef(({className:t,...s},n)=>e.jsx("h5",{ref:n,className:c("mb-1 font-medium leading-none tracking-tight",t),...s}));y.displayName="AlertTitle";const b=r.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:c("text-sm [&_p]:leading-relaxed",t),...s}));b.displayName="AlertDescription";const ke=()=>{const[t,s]=r.useState(!1),[n,a]=r.useState([]),[g,k]=r.useState(null),[f,p]=r.useState(null),d=r.useRef(null),M=o=>{const i=o.target.files?.[0];if(console.log({file:i}),i){k(i);const h=new FileReader;h.onload=m=>{const N=(m.target?.result).split(`
`).map(A=>A.split(","));a(N.slice(0,5)),p(null)},h.onerror=()=>{p("Error reading file")},h.readAsText(i)}};r.useEffect(()=>{t||(k(null),a([]),p(null),d.current&&(d.current.value=""))},[t]);const C=()=>{if(console.log("Uploading data:",n),s(!1),a([]),d.current&&(d.current.value=""),!g)return;const o=new FormData;o.append("document",g),q.promise(fetch("/api/external/upload",{method:"POST",body:o,headers:{Authorization:`Bearer ${J.get()}`}}),{loading:"Загружаем данные...",success:"Данные загружены",error:"Ошибка загрузки данных",finally:()=>E.init()})};return e.jsxs(B,{open:t,onOpenChange:s,children:[e.jsx(F,{asChild:!0,children:e.jsxs(u,{className:"w-full",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Добавить пациента"]})}),e.jsxs(_,{className:"sm:max-w-[625px]",children:[e.jsxs(U,{children:[e.jsx(R,{children:"Добавить пациента"}),e.jsx(z,{children:"Загрузите CSV файл, содержащий данные пациента. Файл должен иметь заголовки в первой строке."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx("input",{id:"csv-file",type:"file",accept:".csv",onChange:M,ref:d}),f&&e.jsxs(L,{variant:"destructive",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx(y,{children:"Error"}),e.jsx(b,{children:f})]}),n.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsx(j,{children:n[0].map((o,i)=>e.jsx(Z,{children:o},i))})}),e.jsx(ee,{children:n.slice(1).map((o,i)=>e.jsx(j,{children:o.map((h,m)=>e.jsx(te,{children:h},m))},i))})]})})]}),e.jsxs(G,{children:[e.jsx(u,{variant:"outline",onClick:()=>s(!1),children:"Отмена"}),e.jsx(u,{onClick:C,disabled:n.length===0,children:"Добавить"})]})]})]})},fe=v(()=>{const t=E;return e.jsxs("aside",{className:"flex flex-col bg-card py-5 min-w-[400px] h-full overflow-hidden",children:[e.jsx("div",{className:"px-6",children:e.jsx($,{placeholder:"Введите имя",rightIcon:e.jsx(re,{})})}),e.jsx("h2",{className:"px-6 py-5 font-semibold text-sm text-slate-500",children:"Мои пациенты"}),e.jsx("ul",{className:"flex-1 flex flex-col overflow-auto",children:t.patients.map(s=>e.jsx(ue,{item:s},s.id))}),e.jsx("div",{className:"px-6 pt-2",children:e.jsx(ke,{})})]})}),Le=()=>e.jsxs("div",{className:"flex size-full",children:[e.jsx(fe,{}),e.jsx("div",{className:"w-full",children:e.jsx(K,{})})]});export{Le as component};
