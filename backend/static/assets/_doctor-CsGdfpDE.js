import{c as j,o as v,u as T,b as A,j as e,d,e as P,m as _,r as l,f as I,D as R,g as E,B as p,h as O,i as V,k as F,l as U,n as B,J as H,p as z,I as J,O as M}from"./index-CxL__hIQ.js";import{P as $,a as q,b as L,T as G,c as K,d as g,e as Q,f as W,g as X,S as Y}from"./table-CUyVR68N.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=j("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=j("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),se=v(s=>{const t=T(),{id:a}=A({strict:!1});return e.jsxs("li",{onClick:()=>t({to:"/patient/$id",params:{id:s.item.id.toString()}}),className:d("flex flex-col relative py-3 px-6 cursor-pointer",a===s.item.id.toString()&&"bg-slate-50"),children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("small",{className:"text-slate-500 font-medium block",children:s.item.first_name}),e.jsxs("p",{className:"text-lg font-medium",children:[s.item.last_name," ",s.item.first_name," ",s.item.middle_name]})]}),e.jsx($,{data:s.item.risk_of_disease})]}),e.jsx(q,{data:s.item.risk_of_disease,text:s.item.alert}),e.jsx("p",{className:"text-slate-800 text-sm pt-1 pb-3",children:s.item.diagnosis}),e.jsx("a",{href:s.item.telegram_link,target:"_blank",onClick:n=>n.stopPropagation(),className:d(P({variant:"outline",size:"sm"})),children:"Написать сообщение"})]})});class te{patients=[];constructor(){_(this),this.init()}async init(){const[t]=await Promise.all([L.get()]);this.patients=t}}const y=new te,ae=I("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),b=l.forwardRef(({className:s,variant:t,...a},n)=>e.jsx("div",{ref:n,role:"alert",className:d(ae({variant:t}),s),...a}));b.displayName="Alert";const N=l.forwardRef(({className:s,...t},a)=>e.jsx("h5",{ref:a,className:d("mb-1 font-medium leading-none tracking-tight",s),...t}));N.displayName="AlertTitle";const k=l.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:d("text-sm [&_p]:leading-relaxed",s),...t}));k.displayName="AlertDescription";const le=()=>{const[s,t]=l.useState(!1),[a,n]=l.useState([]),[u,h]=l.useState(null),[f,x]=l.useState(null),o=l.useRef(null),w=i=>{const r=i.target.files?.[0];if(console.log({file:r}),r){h(r);const c=new FileReader;c.onload=m=>{const D=(m.target?.result).split(`
`).map(S=>S.split(","));n(D.slice(0,5)),x(null)},c.onerror=()=>{x("Error reading file")},c.readAsText(r)}};l.useEffect(()=>{s||(h(null),n([]),x(null),o.current&&(o.current.value=""))},[s]);const C=()=>{if(console.log("Uploading data:",a),t(!1),n([]),o.current&&(o.current.value=""),!u)return;const i=new FormData;i.append("document",u),H.promise(fetch("/api/external/upload",{method:"POST",body:i,headers:{Authorization:`Bearer ${z.get()}`}}),{loading:"Загружаем данные...",success:"Данные загружены",error:"Ошибка загрузки данных",finally:()=>y.init()})};return e.jsxs(R,{open:s,onOpenChange:t,children:[e.jsx(E,{asChild:!0,children:e.jsxs(p,{className:"w-full",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Добавить пациента"]})}),e.jsxs(O,{className:"sm:max-w-[625px]",children:[e.jsxs(V,{children:[e.jsx(F,{children:"Добавить пациента"}),e.jsx(U,{children:"Загрузите CSV файл, содержащий данные пациента. Файл должен иметь заголовки в первой строке."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx("input",{id:"csv-file",type:"file",accept:".csv",onChange:w,ref:o}),f&&e.jsxs(b,{variant:"destructive",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx(N,{children:"Error"}),e.jsx(k,{children:f})]}),a.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(G,{children:[e.jsx(K,{children:e.jsx(g,{children:a[0].map((i,r)=>e.jsx(Q,{children:i},r))})}),e.jsx(W,{children:a.slice(1).map((i,r)=>e.jsx(g,{children:i.map((c,m)=>e.jsx(X,{children:c},m))},r))})]})})]}),e.jsxs(B,{children:[e.jsx(p,{variant:"outline",onClick:()=>t(!1),children:"Отмена"}),e.jsx(p,{onClick:C,disabled:a.length===0,children:"Добавить"})]})]})]})},ie=v(()=>{const s=y;return e.jsxs("aside",{className:"flex flex-col bg-card py-5 min-w-[480px] h-full overflow-hidden",children:[e.jsx("div",{className:"px-6",children:e.jsx(J,{placeholder:"Введите имя",rightIcon:e.jsx(Y,{})})}),e.jsx("h2",{className:"px-6 py-5 font-semibold text-sm text-slate-500",children:"Мои пациенты"}),e.jsx("ul",{className:"flex-1 flex flex-col overflow-auto",children:s.patients.map(t=>e.jsx(se,{item:t},t.id))}),e.jsx("div",{className:"px-6 pt-2",children:e.jsx(le,{})})]})}),de=()=>e.jsxs("div",{className:"flex size-full",children:[e.jsx(ie,{}),e.jsx("div",{className:"w-full",children:e.jsx(M,{})})]});export{de as component};
